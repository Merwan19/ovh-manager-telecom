<section class="telephony-group-service-voicemail-management">

    <audio id="voicemailAudio"
           preload="none"></audio>

    <div class="widget-presentation">
        <h2 class="widget-presentation-title"
            data-translate="telephony_line_answer_voicemail_directories_title"></h2>
    </div>

    <toast-message></toast-message>

    <div class="row">
        <div class="col-xs-12 mb-2">
            <button class="btn btn-default no-transition"
                    type="button"
                    data-ng-click="VoicemailManagementCtrl.deleteSelectedMessages()"
                    data-ng-disabled="VoicemailManagementCtrl.messages.isDeleting"
                    data-ng-if="!VoicemailManagementCtrl.messages.isLoading && VoicemailManagementCtrl.getSelection().length">
                <span data-ng-if="VoicemailManagementCtrl.getSelection().length === 1"
                      data-translate="telephony_line_answer_voicemail_directories_delete_message">
                </span>
                <span data-ng-if="VoicemailManagementCtrl.getSelection().length > 1"
                      data-translate="telephony_line_answer_voicemail_directories_delete_message_plural"
                      data-translate-values="{ count: VoicemailManagementCtrl.getSelection().length }">
                </span>
                <bouncing-box-loader class="d-inline-block align-middle ml-2"
                                     data-ng-if="VoicemailManagementCtrl.messages.isDeleting"
                                     data-size="s">
                </bouncing-box-loader>
            </button>
        </div>
    </div>

    <div class="row">
        <div class="col-xs-12 table-responsive">
            <table class="table"
                   data-ng-class="{
                       'table-hover table-striped': VoicemailManagementCtrl.messages.raw.length > 1
                   }">
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox"
                                   data-ng-if="VoicemailManagementCtrl.messages.paginated.length"
                                   data-ng-disabled="VoicemailManagementCtrl.messages.isDeleting"
                                   ovh-checkbox-table
                                   ovh-checkbox-table-ids-all="VoicemailManagementCtrl.messages.raw"
                                   ovh-checkbox-table-ids-page="VoicemailManagementCtrl.messages.paginated"
                                   ovh-checkbox-table-ids-selected="VoicemailManagementCtrl.messages.selected"
                                   ovh-checkbox-table-id="id" />
                        </th>
                        <th>
                            <button class="btn btn-link p-0"
                                    type="button"
                                    data-ng-disabled="!VoicemailManagementCtrl.messages.paginated.length"
                                    data-ng-click="VoicemailManagementCtrl.orderBy('caller')">
                                <span data-translate="telephony_line_answer_voicemail_directories_caller"></span>
                                <span class="oui-icon align-baseline"
                                      aria-hidden="true"
                                      data-ng-class="{
                                          'oui-icon-arrow-down': VoicemailManagementCtrl.messages.orderBy !== 'caller',
                                          'oui-icon-arrow-down': VoicemailManagementCtrl.messages.orderBy === 'caller' && VoicemailManagementCtrl.messages.orderDesc,
                                          'oui-icon-arrow-up': VoicemailManagementCtrl.messages.orderBy === 'caller' && !VoicemailManagementCtrl.messages.orderDesc
                                      }">
                                </span>
                            </button>
                        </th>
                        <th>
                            <button class="btn btn-link p-0"
                                    type="button"
                                    data-ng-disabled="!VoicemailManagementCtrl.messages.paginated.length"
                                    data-ng-click="VoicemailManagementCtrl.orderBy('creationDatetime')">
                                <span data-translate="telephony_line_answer_voicemail_directories_date"></span>
                                <span class="oui-icon align-baseline"
                                      aria-hidden="true"
                                      data-ng-class="{
                                          'oui-icon-arrow-down': VoicemailManagementCtrl.messages.orderBy !== 'creationDatetime',
                                          'oui-icon-arrow-down': VoicemailManagementCtrl.messages.orderBy === 'creationDatetime' && VoicemailManagementCtrl.messages.orderDesc,
                                          'oui-icon-arrow-up': VoicemailManagementCtrl.messages.orderBy === 'creationDatetime' && !VoicemailManagementCtrl.messages.orderDesc
                                      }">
                                </span>
                            </button>
                        </th>
                        <th>
                            <button class="btn btn-link p-0"
                                    type="button"
                                    data-ng-disabled="!VoicemailManagementCtrl.messages.paginated.length"
                                    data-ng-click="VoicemailManagementCtrl.orderBy('durationAsDate')">
                                <span data-translate="telephony_line_answer_voicemail_directories_duration"></span>
                                <span class="oui-icon align-baseline"
                                      aria-hidden="true"
                                      data-ng-class="{
                                          'oui-icon-arrow-down': VoicemailManagementCtrl.messages.orderBy !== 'durationAsDate',
                                          'oui-icon-arrow-down': VoicemailManagementCtrl.messages.orderBy === 'durationAsDate' && VoicemailManagementCtrl.messages.orderDesc,
                                          'oui-icon-arrow-up': VoicemailManagementCtrl.messages.orderBy === 'durationAsDate' && !VoicemailManagementCtrl.messages.orderDesc
                                      }">
                                </span>
                            </button>
                        </th>
                        <th>
                            <button class="btn btn-link p-0"
                                    type="button"
                                    title="{{:: 'telephony_line_answer_voicemail_directories_refresh_message' | translate }}"
                                    data-ng-disabled="VoicemailManagementCtrl.messages.isDeleting"
                                    data-ng-click="VoicemailManagementCtrl.refresh()">
                                <i class="text-default fa fa-refresh"></i>
                            </button>
                        </th>
                    </tr>
                </thead>
                <tbody data-ng-if="!VoicemailManagementCtrl.messages.isLoading">
                    <tr data-ng-repeat="message in VoicemailManagementCtrl.messages.paginated | orderBy:VoicemailManagementCtrl.order.by:VoicemailManagementCtrl.order.reverse">
                        <td>
                            <input type="checkbox"
                                   data-ng-disabled="VoicemailManagementCtrl.messages.isDeleting"
                                   data-ng-model="VoicemailManagementCtrl.messages.selected[message.id]"></input>
                        </td>
                        <td data-title="{{:: 'telephony_line_answer_voicemail_directories_caller' | translate }}">
                            <span class="text-nowrap" data-ng-bind="message.caller | phoneNumber"></span>
                        </td>
                        <td data-title="{{:: 'telephony_line_answer_voicemail_directories_date' | translate }}">
                            <span class="text-nowrap" data-ng-bind="message.creationDatetime | date: 'dd/MM/yyyy'"></span>
                            <span class="text-nowrap" data-ng-bind="message.creationDatetime | date: 'HH:mm:ss'"></span>
                        </td>
                        <td data-title="{{:: 'telephony_line_answer_voicemail_directories_duration' | translate }}">
                            <span class="text-nowrap" data-ng-bind="message.durationAsDate | date: 'mm:ss': 'UTC'"></span>
                        </td>
                        <td class="voicemail-management-button-container">
                            <button class="btn btn-link mr-2"
                                    type="button"
                                    title="{{:: 'telephony_line_answer_voicemail_directories_listen_message' | translate }}"
                                    data-ng-disabled="VoicemailManagementCtrl.messages.isDeleting"
                                    data-ng-click="VoicemailManagementCtrl.listenMessage(message)">
                                <i class="fa fa-play-circle-o"
                                   data-ng-if="VoicemailManagementCtrl.messages.playing !== message && !message.pendingListen"></i>
                                <i class="fa fa-stop-circle-o"
                                   data-ng-if="VoicemailManagementCtrl.messages.playing === message && !message.pendingListen"></i>
                                <bouncing-box-loader class="d-inline-block align-middle ml-2"
                                                     data-ng-if="message.pendingListen"
                                                     data-size="s">
                                </bouncing-box-loader>
                            </button>
                            <button class="btn btn-link mr-2"
                                    type="button"
                                    title="{{:: 'telephony_line_answer_voicemail_directories_download_message' | translate }}"
                                    data-ng-disabled="VoicemailManagementCtrl.messages.isDeleting"
                                    data-ng-click="VoicemailManagementCtrl.downloadMessage(message)">
                                <i class="fa fa-download"
                                   data-ng-if="!message.pendingDownload"></i>
                                <bouncing-box-loader class="d-inline-block align-middle ml-2"
                                                     data-ng-if="message.pendingDownload"
                                                     data-size="s">
                                </bouncing-box-loader>
                            </button>
                            <button class="btn btn-link"
                                    type="button"
                                    title="{{:: 'telephony_line_answer_voicemail_directories_delete_message' | translate }}"
                                    data-ng-disabled="VoicemailManagementCtrl.messages.isDeleting"
                                    data-ng-click="VoicemailManagementCtrl.deleteMessage(message)">
                                <i class="ovh-font ovh-font-bin align-top"
                                   data-ng-if="!message.isDeleting"></i>
                                <bouncing-box-loader class="d-inline-block align-middle ml-2"
                                                     data-ng-if="message.isDeleting"
                                                     data-size="s">
                                </bouncing-box-loader>
                            </button>
                        </td>
                    </tr>
                </tbody>
                <tbody data-ng-if="VoicemailManagementCtrl.messages.isLoading">
                    <tr>
                        <td class="text-center my-3"
                            colspan="5">
                            <span data-translate="telephony_line_answer_voicemail_directories_loading"></span>
                            <bouncing-box-loader class="d-inline-block align-middle ml-2"
                                                 data-size="s">
                            </bouncing-box-loader>
                        </td>
                    </tr>
                </tbody>
                <tbody data-ng-if="!VoicemailManagementCtrl.messages.isLoading && !VoicemailManagementCtrl.messages.paginated.length">
                    <tr>
                        <td class="text-center my-3"
                            colspan="5">
                            <span data-translate="telephony_line_answer_voicemail_directories_empty"></span>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="mt-2"
                 data-ng-if="!VoicemailManagementCtrl.messages.isLoading && VoicemailManagementCtrl.messages.raw.length"
                 data-pagination-front
                 data-items="VoicemailManagementCtrl.messages.sorted"
                 data-paginated-items="VoicemailManagementCtrl.messages.paginated"
                 data-current-page="currentPage"
                 data-nb-pages="nbPages"
                 data-items-per-page="itemsPerPage"
                 data-page-placeholder="{{'common_pagination_page' | translate: {currentPage:currentPage, nbPages:nbPages} }}"
                 data-item-per-page-placeholder="{{'common_pagination_display' | translate}}">
            </div>
        </div>
    </div>

</section>
