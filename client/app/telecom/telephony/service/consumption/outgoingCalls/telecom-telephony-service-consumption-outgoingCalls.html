<div class="telephony-group-service-consumption-outgoing-calls">

    <div class="widget-presentation">
        <h2 class="widget-presentation-title"
            data-translate="telephony_service_consumption_outgoing_all"></h2>
    </div>

    <toast-message></toast-message>

    <div class="row">
        <div class="col-sm-6">
            <div data-translate="telephony_service_consumption_outgoing_period"
                 data-translate-values="{ start: OutgoingCallsCtrl.period.start.format('DD/MM/YYYY'),
                                          end: OutgoingCallsCtrl.period.end.format('DD/MM/YYYY') }">
            </div>
            <div data-ng-if="OutgoingCallsCtrl.consumption.raw.length"
                 data-translate="telephony_service_consumption_outgoing_priceplan"
                 data-translate-values="{ calls: OutgoingCallsCtrl.consumption.sum.pricePlan.calls,
                                          duration: (OutgoingCallsCtrl.consumption.sum.pricePlan.durationAsDate | date: 'HH:mm:ss': 'UTC') }">
            </div>
            <div data-ng-if="OutgoingCallsCtrl.consumption.raw.length"
                 data-translate="telephony_service_consumption_outgoing_outplan"
                 data-translate-values="{ calls: OutgoingCallsCtrl.consumption.sum.outPlan.calls,
                                          duration: (OutgoingCallsCtrl.consumption.sum.outPlan.durationAsDate | date: 'HH:mm:ss': 'UTC'),
                                          price: OutgoingCallsCtrl.consumption.sum.outPlan.price }">
            </div>
        </div>
    </div>
    <div class="row"
         data-ng-if="OutgoingCallsCtrl.consumption.raw.length">
        <div class="col-xs-12">
            <button class="btn btn-default float-right"
                    type="button"
                    data-ng-click="OutgoingCallsCtrl.toggleShowFilter()">
                <i data-ng-if="!OutgoingCallsCtrl.consumption.showFilter"
                   class="ovh-font ovh-font-filter"></i>
                <i data-ng-if="OutgoingCallsCtrl.consumption.showFilter"
                   class="ovh-font ovh-font-wrong"></i>
                <span class="ml-1"
                      data-translate="telephony_service_consumption_filter"></span>
            </button>
        </div>
    </div>
    <div class="mt-2"
         data-ng-if="OutgoingCallsCtrl.consumption.showFilter">
        <div class="row">
            <div class="col-sm-4 col-sm-offset-4">
                <div class="input-group">
                    <span class="input-group-addon">
                        <i class="ovh-font ovh-font-phone"></i>
                    </span>
                    <input class="form-control"
                           type="text"
                           data-ng-change="OutgoingCallsCtrl.applySorting()"
                           data-ng-model="OutgoingCallsCtrl.consumption.filterBy.dialed"
                           placeholder="{{:: 'telephony_service_consumption_dialed' | translate }}" />
                </div>
            </div>
            <div class="col-sm-4">
                <select class="form-control"
                        data-ng-change="OutgoingCallsCtrl.applySorting()"
                        data-ng-model="OutgoingCallsCtrl.consumption.filterBy.destinationType"
                        required>
                    <option value="" data-translate="telephony_service_consumption_destination_any"></option>
                    <option value="landline" data-translate="telephony_service_consumption_destination_landline"></option>
                    <option value="mobile" data-translate="telephony_service_consumption_destination_mobile"></option>
                    <option value="special" data-translate="telephony_service_consumption_destination_special"></option>
                </select>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-12 mt-1">
            <div class="table-responsive">
                <table class="table"
                       data-ng-class="{
                           'table-hover table-striped': OutgoingCallsCtrl.consumption.raw.length > 1
                       }">
                    <thead>
                        <tr>
                            <th>
                                <button class="btn btn-link pl-0"
                                        type="button"
                                        data-ng-disabled="!OutgoingCallsCtrl.consumption.paginated.length"
                                        data-ng-click="OutgoingCallsCtrl.orderBy('creationDatetime')">
                                    <span data-translate="telephony_service_consumption_date"></span>
                                    <span class="oui-icon align-baseline"
                                          aria-hidden="true"
                                          data-ng-class="{
                                              'oui-icon-arrow-down': OutgoingCallsCtrl.consumption.orderBy !== 'creationDatetime',
                                              'oui-icon-arrow-down': OutgoingCallsCtrl.consumption.orderBy === 'creationDatetime' && OutgoingCallsCtrl.consumption.orderDesc,
                                              'oui-icon-arrow-up': OutgoingCallsCtrl.consumption.orderBy === 'creationDatetime' && !OutgoingCallsCtrl.consumption.orderDesc
                                          }">
                                    </span>
                                </button>
                            </th>
                            <th>
                                <button class="btn btn-link pl-0"
                                        type="button"
                                        data-ng-disabled="!OutgoingCallsCtrl.consumption.paginated.length"
                                        data-ng-click="OutgoingCallsCtrl.orderBy('dialed')">
                                    <span data-translate="telephony_service_consumption_dialed"></span>
                                    <span class="oui-icon align-baseline"
                                          aria-hidden="true"
                                          data-ng-class="{
                                              'oui-icon-arrow-down': OutgoingCallsCtrl.consumption.orderBy !== 'dialed',
                                              'oui-icon-arrow-down': OutgoingCallsCtrl.consumption.orderBy === 'dialed' && OutgoingCallsCtrl.consumption.orderDesc,
                                              'oui-icon-arrow-up': OutgoingCallsCtrl.consumption.orderBy === 'dialed' && !OutgoingCallsCtrl.consumption.orderDesc
                                          }">
                                    </span>
                                </button>
                            </th>
                            <th>
                                <button class="btn btn-link pl-0"
                                        type="button"
                                        data-ng-disabled="!OutgoingCallsCtrl.consumption.paginated.length"
                                        data-ng-click="OutgoingCallsCtrl.orderBy('durationAsDate')">
                                    <span data-translate="telephony_service_consumption_duration"></span>
                                    <span class="oui-icon align-baseline"
                                          aria-hidden="true"
                                          data-ng-class="{
                                              'oui-icon-arrow-down': OutgoingCallsCtrl.consumption.orderBy !== 'durationAsDate',
                                              'oui-icon-arrow-down': OutgoingCallsCtrl.consumption.orderBy === 'durationAsDate' && OutgoingCallsCtrl.consumption.orderDesc,
                                              'oui-icon-arrow-up': OutgoingCallsCtrl.consumption.orderBy === 'durationAsDate' && !OutgoingCallsCtrl.consumption.orderDesc
                                          }">
                                    </span>
                                </button>
                            </th>
                            <th>
                                <button class="btn btn-link pl-0"
                                        type="button"
                                        data-ng-disabled="!OutgoingCallsCtrl.consumption.paginated.length"
                                        data-ng-click="OutgoingCallsCtrl.orderBy('wayType')">
                                    <span data-translate="telephony_service_consumption_type"></span>
                                    <span class="oui-icon align-baseline"
                                          aria-hidden="true"
                                          data-ng-class="{
                                              'oui-icon-arrow-down': OutgoingCallsCtrl.consumption.orderBy !== 'wayType',
                                              'oui-icon-arrow-down': OutgoingCallsCtrl.consumption.orderBy === 'wayType' && OutgoingCallsCtrl.consumption.orderDesc,
                                              'oui-icon-arrow-up': OutgoingCallsCtrl.consumption.orderBy === 'wayType' && !OutgoingCallsCtrl.consumption.orderDesc
                                          }">
                                    </span>
                                </button>
                            </th>
                            <th>
                                <button class="btn btn-link pl-0"
                                        type="button"
                                        data-ng-disabled="!OutgoingCallsCtrl.consumption.paginated.length"
                                        data-ng-click="OutgoingCallsCtrl.orderBy('destinationType')">
                                    <span data-translate="telephony_service_consumption_destination"></span>
                                    <span class="oui-icon align-baseline"
                                          aria-hidden="true"
                                          data-ng-class="{
                                              'oui-icon-arrow-down': OutgoingCallsCtrl.consumption.orderBy !== 'destinationType',
                                              'oui-icon-arrow-down': OutgoingCallsCtrl.consumption.orderBy === 'destinationType' && OutgoingCallsCtrl.consumption.orderDesc,
                                              'oui-icon-arrow-up': OutgoingCallsCtrl.consumption.orderBy === 'destinationType' && !OutgoingCallsCtrl.consumption.orderDesc
                                          }">
                                    </span>
                                </button>
                            </th>
                            <th>
                                <button class="btn btn-link pl-0"
                                        type="button"
                                        data-ng-disabled="!OutgoingCallsCtrl.consumption.paginated.length"
                                        data-ng-click="OutgoingCallsCtrl.orderBy('priceWithoutTax.value')">
                                    <span data-translate="telephony_service_consumption_price_ht"></span>
                                    <span class="oui-icon align-baseline"
                                          aria-hidden="true"
                                          data-ng-class="{
                                              'oui-icon-arrow-down': OutgoingCallsCtrl.consumption.orderBy !== 'priceWithoutTax.value',
                                              'oui-icon-arrow-down': OutgoingCallsCtrl.consumption.orderBy === 'priceWithoutTax.value' && OutgoingCallsCtrl.consumption.orderDesc,
                                              'oui-icon-arrow-up': OutgoingCallsCtrl.consumption.orderBy === 'priceWithoutTax.value' && !OutgoingCallsCtrl.consumption.orderDesc
                                          }">
                                    </span>
                                </button>
                                <button class="btn btn-link pl-0 ml-2"
                                        type="button"
                                        data-ng-disabled="OutgoingCallsCtrl.consumption.isLoading"
                                        data-ng-click="OutgoingCallsCtrl.refresh()">
                                    <i class="fa fa-refresh"></i>
                                </button>
                            </th>
                        </tr>
                    </thead>
                    <tbody data-ng-if="!OutgoingCallsCtrl.consumption.isLoading">
                        <tr data-ng-repeat="conso in OutgoingCallsCtrl.consumption.paginated | orderBy:OutgoingCallsCtrl.order.by:OutgoingCallsCtrl.order.reverse">
                            <td data-title="{{:: 'telephony_service_consumption_date' | translate }}">
                                <span class="text-nowrap mr-3" data-ng-bind="::conso.creationDatetime | date: 'dd/MM/yyyy'"></span>
                                <span class="text-nowrap mr-3" data-ng-bind="::conso.creationDatetime | date: 'HH:mm:ss'"></span>
                            </td>
                            <td data-title="{{:: 'telephony_service_consumption_dialed' | translate }}">
                                <span class="text-nowrap" data-ng-bind="::conso.dialed | phoneNumber"></span>
                            </td>
                            <td data-title="{{:: 'telephony_service_consumption_duration' | translate }}">
                                <span class="text-nowrap mr-3" data-ng-bind="::conso.durationAsDate | date: 'HH:mm:ss': 'UTC'"></span>
                            </td>
                            <td data-title="{{:: 'telephony_service_consumption_type' | translate }}">
                                <span class="text-nowrap" data-ng-bind="::'telephony_service_consumption_type_' + conso.wayType | translate"></span>
                            </td>
                            <td data-title="{{:: 'telephony_service_consumption_destination' | translate }}">
                                <span class="text-nowrap" data-ng-bind="::'telephony_service_consumption_destination_' + conso.destinationType | translate"></span>
                            </td>
                            <td data-title="{{:: 'telephony_service_consumption_price_ht' | translate }}">
                                <span class="text-nowrap" data-ng-bind="::conso.priceWithoutTax.text || '-'"></span>
                            </td>
                        </tr>
                    </tbody>
                    <tbody data-ng-if="OutgoingCallsCtrl.consumption.isLoading">
                        <tr>
                            <td class="text-center py-3" colspan="6">
                                <bouncing-box-loader class="d-inline-block align-middle"
                                                     data-size="s">
                                </bouncing-box-loader>
                            </td>
                        </tr>
                    </tbody>
                    <tbody data-ng-if="!OutgoingCallsCtrl.consumption.isLoading && !OutgoingCallsCtrl.consumption.raw.length">
                        <tr>
                            <td class="text-center py-3" colspan="6">
                                <span data-translate="telephony_service_consumption_outgoing_empty"></span>
                            </td>
                        </tr>
                    </tbody>
                    <tbody data-ng-if="!OutgoingCallsCtrl.consumption.isLoading &&
                                       OutgoingCallsCtrl.consumption.raw.length &&
                                       !OutgoingCallsCtrl.consumption.paginated.length">
                        <tr>
                            <td class="text-center py-3" colspan="6">
                                <span data-translate="telephony_service_consumption_outgoing_not_found"></span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="mt-2"
                 data-ng-if="!OutgoingCallsCtrl.consumption.isLoading && OutgoingCallsCtrl.consumption.raw.length"
                 data-pagination-front
                 data-items="OutgoingCallsCtrl.consumption.sorted"
                 data-paginated-items="OutgoingCallsCtrl.consumption.paginated"
                 data-current-page="currentPage"
                 data-nb-pages="nbPages"
                 data-items-per-page="itemsPerPage"
                 data-page-placeholder="{{'common_pagination_page' | translate: {currentPage:currentPage, nbPages:nbPages} }}"
                 data-item-per-page-placeholder="{{'common_pagination_display' | translate}}">
            </div>
        </div>
    </div>

</div>
